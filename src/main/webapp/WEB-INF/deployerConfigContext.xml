<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:sec="http://www.springframework.org/schema/security" xmlns:cas="http://unicon.net/schema/cas"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security-3.1.xsd
                           http://unicon.net/schema/cas
                           http://unicon.net/schema/cas/cas-addons.xsd">


	<bean id="authenticationManager" class="org.jasig.cas.authentication.PolicyBasedAuthenticationManager">
		<constructor-arg>
			<map>
				<entry key-ref="proxyAuthenticationHandler" value-ref="proxyPrincipalResolver" />
				<entry key-ref="primaryAuthenticationHandler" value-ref="primaryPrincipalResolver" />
			</map>
		</constructor-arg>
		<property name="authenticationPolicy">
			<bean class="org.jasig.cas.authentication.AnyAuthenticationPolicy" />
		</property>
	</bean>

	<!-- Required for proxy ticket mechanism. -->
	<bean id="proxyAuthenticationHandler" class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
		p:httpClient-ref="httpClient" />
	<!-- Required for proxy ticket mechanism -->
	<bean id="proxyPrincipalResolver" class="org.jasig.cas.authentication.principal.BasicPrincipalResolver" />
	
	
	<cas:bind-ldap-authentication-handler
		id="primaryAuthenticationHandler"
		urls="${ldap.url}" 
		user-dn="${ldap.managerDn}" 
		password="${ldap.managerPassword}"
		search-base="${ldap.user.baseDn}" 
		filter="${ldap.user.searchFilter}"
		is-pooled="${ldap.pool.is-pooled}"
		ignore-partial-result-exception="${ldap.ignore-partial-result-exception}"
		expose-context-source-bean-as="contextSource">
        <cas:ldap-properties>
            <cas:ldap-prop key="com.sun.jndi.ldap.connect.timeout" value="${com.sun.jndi.ldap.connect.timeout}"/>
            <cas:ldap-prop key="com.sun.jndi.ldap.read.timeout" value="${com.sun.jndi.ldap.read.timeout}"/>
            <cas:ldap-prop key="java.naming.security.authentication" value="${java.naming.security.authentication}"/>
            <cas:ldap-prop key="java.naming.referral" value="${java.naming.referral}"/>
        </cas:ldap-properties>
	</cas:bind-ldap-authentication-handler>

	<!--
		| Resolves a principal from a credential using an attribute repository that is configured to resolve
		| against a deployer-specific store (e.g. LDAP).
	-->
	<bean id="primaryPrincipalResolver" class="org.jasig.cas.authentication.principal.PersonDirectoryPrincipalResolver">
		<property name="attributeRepository" ref="attributeRepository" />
	</bean>
	<cas:json-attribute-repository />



	<!-- || for serviceRegistryDao || -->
	<cas:json-services-registry config-file="file:/etc/cas/servicesRegistry.conf"/>

	<cas:inspektr-log-files-audit-manager />

	<cas:default-health-check-monitor />

	<sec:user-service id="userDetailsService">
		<sec:user name="none" authorities="none" />
	</sec:user-service>

</beans>
